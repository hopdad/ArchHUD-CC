{
  "slots": {
    "0": {
      "name": "db",
      "type": {
        "events": [],
        "methods": []
      }
    },
    "1": {
      "name": "screen",
      "type": {
        "events": [],
        "methods": []
      }
    },
    "-1": {
      "name": "unit",
      "type": {
        "events": [],
        "methods": []
      }
    },
    "-2": {
      "name": "system",
      "type": {
        "events": [],
        "methods": []
      }
    },
    "-3": {
      "name": "library",
      "type": {
        "events": [],
        "methods": []
      }
    }
  },
  "handlers": [
    {
      "code": "-- ArchHUD Telemetry Dashboard - Programming Board Script\n-- Reads telemetry data from a shared databank and renders a dashboard on a linked screen.\n--\n-- ═══════════════════════════════════════════════════════\n-- SETUP INSTRUCTIONS\n-- ═══════════════════════════════════════════════════════\n-- 1. Place a programming board, a screen, and link BOTH to the same databank\n--    used by your ArchHUD seat (the dbHud slot).\n-- 2. Right-click the programming board > Advanced > Edit Lua.\n-- 3. In the slot list (left side), rename the databank slot to \"db\"\n--    and the screen slot to \"screen\".\n-- 4. Select the filter: unit > onStart\n--    Paste this ENTIRE script into the code editor.\n-- 5. Add a NEW filter: unit > onTimer(timerId)\n--    Paste this single line:     onBoardTick(timerId)\n-- 6. Add a NEW filter: unit > onStop\n--    Paste this single line:     if screen then screen.setHTML(\"\") end\n-- 7. Apply changes and activate the programming board.\n-- ═══════════════════════════════════════════════════════\n--\n-- Slots (rename in the Lua editor slot list):\n--   db     = databank (same one linked to your seat/ECU as dbHud)\n--   screen = ScreenUnit\n\nlocal db = db ---@type databank\nlocal screen = screen ---@type ScreenUnit\nlocal unit = unit ---@type ProgrammingBoard\nlocal system = system\n\n-- json fallback for emulators (du-lua.dev) where the library slot\n-- doesn't inject the json global automatically.\nif not json then\n    json = {}\n    -- Minimal JSON decoder\n    function json.decode(s)\n        if not s or s == \"\" then return nil end\n        local i = 1\n        local V\n        local function w() while i <= #s and s:byte(i) <= 32 do i = i + 1 end end\n        local function S()\n            i = i + 1; local b = {}\n            while true do\n                local c = s:sub(i,i)\n                if c == '\"' then break\n                elseif c == '\\\\' then i=i+1; c=s:sub(i,i); if c=='n' then b[#b+1]='\\n' elseif c=='t' then b[#b+1]='\\t' else b[#b+1]=c end\n                else b[#b+1] = c end\n                i = i + 1\n            end\n            i = i + 1; return table.concat(b)\n        end\n        V = function()\n            w(); local c = s:sub(i,i)\n            if c == '\"' then return S()\n            elseif c == '{' then\n                i=i+1; w(); local t = {}\n                if s:sub(i,i) ~= '}' then\n                    local k = S(); w(); i=i+1; t[k] = V()\n                    while true do w(); if s:sub(i,i) ~= ',' then break end; i=i+1; k=S(); w(); i=i+1; t[k]=V() end\n                end; w(); i=i+1; return t\n            elseif c == '[' then\n                i=i+1; w(); local t = {}\n                if s:sub(i,i) ~= ']' then\n                    t[1]=V(); local n=1\n                    while true do w(); if s:sub(i,i) ~= ',' then break end; i=i+1; n=n+1; t[n]=V() end\n                end; w(); i=i+1; return t\n            elseif c == 't' then i=i+4; return true\n            elseif c == 'f' then i=i+5; return false\n            elseif c == 'n' then i=i+4; return nil\n            else local j2=i; if c=='-' then i=i+1 end; while i<=#s and s:sub(i,i):match('[%deE%.%+%-]') do i=i+1 end; return tonumber(s:sub(j2,i-1))\n            end\n        end\n        local ok, r = pcall(V); return ok and r or nil\n    end\n    -- Minimal JSON encoder\n    function json.encode(val)\n        local buf = {}\n        local function enc(v)\n            local tp = type(v)\n            if v == nil then buf[#buf+1] = \"null\"\n            elseif tp == \"boolean\" then buf[#buf+1] = v and \"true\" or \"false\"\n            elseif tp == \"number\" then\n                if v ~= v then buf[#buf+1] = \"null\"\n                elseif v == 1/0 then buf[#buf+1] = \"1e999\"\n                elseif v == -1/0 then buf[#buf+1] = \"-1e999\"\n                else buf[#buf+1] = string.format(\"%.14g\", v) end\n            elseif tp == \"string\" then\n                buf[#buf+1] = '\"'; buf[#buf+1] = v:gsub('[\\\\\"\\n\\t\\r]', {['\\\\']='\\\\\\\\',  ['\"']='\\\\\"', ['\\n']='\\\\n', ['\\t']='\\\\t', ['\\r']='\\\\r'}); buf[#buf+1] = '\"'\n            elseif tp == \"table\" then\n                -- Detect array vs object: sequential integer keys from 1..#v\n                local n = #v\n                local isArr = n > 0\n                if isArr then for k in pairs(v) do if type(k) ~= \"number\" or k < 1 or k > n or k ~= math.floor(k) then isArr = false; break end end end\n                if isArr then\n                    buf[#buf+1] = '['\n                    for i = 1, n do if i > 1 then buf[#buf+1] = ',' end; enc(v[i]) end\n                    buf[#buf+1] = ']'\n                else\n                    buf[#buf+1] = '{'\n                    local first = true\n                    for k2, v2 in pairs(v) do\n                        if type(k2) == \"string\" then\n                            if not first then buf[#buf+1] = ',' end; first = false\n                            enc(k2); buf[#buf+1] = ':'; enc(v2)\n                        end\n                    end\n                    buf[#buf+1] = '}'\n                end\n            end\n        end\n        enc(val)\n        return table.concat(buf)\n    end\nend\nlocal jdecode = json.decode\nlocal mfloor = math.floor\nlocal stringf = string.format\n\n-- State\nlocal lastUpdate = 0\n\n-- Safe JSON decode with fallback\nlocal function safeDecode(key)\n    if not db.hasKey(key) then return nil end\n    local ok, result = pcall(jdecode, db.getStringValue(key))\n    if ok then return result end\n    return nil\nend\n\n-- Format speed for display\nlocal function fmtSpeed(mps)\n    if mps > 1000 then\n        return stringf(\"%.1f km/s\", mps / 1000)\n    else\n        return stringf(\"%.0f m/s\", mps)\n    end\nend\n\nlocal function fmtSpeedKmh(mps)\n    return stringf(\"%.0f km/h\", mps * 3.6)\nend\n\n-- Format altitude\nlocal function fmtAlt(meters)\n    if meters > 100000 then\n        return stringf(\"%.2f su\", meters / 200000)\n    elseif meters > 1000 then\n        return stringf(\"%.1f km\", meters / 1000)\n    else\n        return stringf(\"%.0f m\", meters)\n    end\nend\n\n-- Format distance\nlocal function fmtDist(meters)\n    if meters > 200000 then\n        return stringf(\"%.2f su\", meters / 200000)\n    elseif meters > 1000 then\n        return stringf(\"%.1f km\", meters / 1000)\n    else\n        return stringf(\"%.0f m\", meters)\n    end\nend\n\n-- Format time from seconds\nlocal function fmtTime(seconds)\n    if seconds <= 0 then return \"0s\" end\n    local d = mfloor(seconds / 86400)\n    local h = mfloor((seconds % 86400) / 3600)\n    local m = mfloor((seconds % 3600) / 60)\n    local s = mfloor(seconds % 60)\n    if d > 365 then return \">1y\"\n    elseif d > 0 then return stringf(\"%dd %dh\", d, h)\n    elseif h > 0 then return stringf(\"%dh %dm\", h, m)\n    elseif m > 0 then return stringf(\"%dm %ds\", m, s)\n    else return stringf(\"%ds\", s)\n    end\nend\n\n-- Color helpers\nlocal function rgb(r, g, b) return stringf(\"rgb(%d,%d,%d)\", r, g, b) end\nlocal function rgba(r, g, b, a) return stringf(\"rgba(%d,%d,%d,%.2f)\", r, g, b, a) end\n\n-- Theme colors\nlocal accentColor = rgb(130, 224, 255)\nlocal dimColor = rgb(90, 155, 180)\nlocal warnColor = rgb(255, 165, 0)\nlocal dangerColor = rgb(255, 60, 60)\nlocal safeColor = rgb(60, 255, 120)\nlocal pvpColor = rgb(255, 60, 60)\nlocal bgColor = rgb(12, 16, 22)\nlocal panelColor = rgba(20, 30, 40, 0.85)\nlocal borderColor = rgba(130, 224, 255, 0.3)\n\n-- Build a fuel bar SVG\nlocal function fuelBar(x, y, w, h, pct, label, color)\n    if not pct then return \"\" end\n    local fill = mfloor(w * pct / 100)\n    local barColor = color or accentColor\n    if pct < 10 then barColor = dangerColor\n    elseif pct < 25 then barColor = warnColor end\n    return stringf([[\n        <text x=\"%d\" y=\"%d\" fill=\"%s\" font-size=\"14\" font-family=\"monospace\">%s</text>\n        <rect x=\"%d\" y=\"%d\" width=\"%d\" height=\"%d\" fill=\"%s\" rx=\"3\"/>\n        <rect x=\"%d\" y=\"%d\" width=\"%d\" height=\"%d\" fill=\"%s\" rx=\"3\"/>\n        <text x=\"%d\" y=\"%d\" fill=\"white\" font-size=\"12\" font-family=\"monospace\" text-anchor=\"end\">%d%%</text>\n    ]], x, y - 4, dimColor, label,\n       x, y, w, h, rgba(40, 50, 60, 0.8),\n       x, y, fill, h, barColor,\n       x + w + 40, y + h - 3, pct)\nend\n\n-- Build status indicator\nlocal function statusDot(x, y, active, label)\n    local color = active and safeColor or rgba(60, 70, 80, 0.8)\n    return stringf([[\n        <circle cx=\"%d\" cy=\"%d\" r=\"5\" fill=\"%s\"/>\n        <text x=\"%d\" y=\"%d\" fill=\"%s\" font-size=\"13\" font-family=\"monospace\">%s</text>\n    ]], x, y, color, x + 12, y + 4, active and accentColor or dimColor, label)\nend\n\n-- Main render function\nlocal function renderDashboard()\n    local flight = safeDecode(\"T_flight\")\n    local ap = safeDecode(\"T_ap\")\n    local ship = safeDecode(\"T_ship\")\n    local fuel = safeDecode(\"T_fuel\")\n\n    -- Screen dimensions (DU screen HTML mode)\n    local sw, sh = 1920, 1080\n\n    local svg = {}\n    svg[#svg+1] = stringf([[<svg viewBox=\"0 0 %d %d\" xmlns=\"http://www.w3.org/2000/svg\">]], sw, sh)\n\n    -- Background\n    svg[#svg+1] = stringf([[<rect width=\"%d\" height=\"%d\" fill=\"%s\"/>]], sw, sh, bgColor)\n\n    -- Title bar\n    local titleColor = accentColor\n    local zoneLabel = \"SAFE ZONE\"\n    if ship and ship.pvp then\n        titleColor = pvpColor\n        zoneLabel = \"PVP ZONE\"\n    end\n    svg[#svg+1] = stringf([[\n        <rect x=\"0\" y=\"0\" width=\"%d\" height=\"50\" fill=\"%s\"/>\n        <text x=\"20\" y=\"34\" fill=\"%s\" font-size=\"22\" font-family=\"monospace\" font-weight=\"bold\">ARCHHUD TELEMETRY</text>\n        <text x=\"%d\" y=\"34\" fill=\"%s\" font-size=\"18\" font-family=\"monospace\" text-anchor=\"end\">%s</text>\n    ]], sw, rgba(20, 30, 40, 0.95), titleColor, sw - 20, ship and ship.pvp and pvpColor or safeColor, zoneLabel)\n\n    if ship and ship.ver then\n        svg[#svg+1] = stringf([[<text x=\"380\" y=\"34\" fill=\"%s\" font-size=\"14\" font-family=\"monospace\">v%s</text>]], dimColor, ship.ver)\n    end\n\n    -- No data fallback\n    if not flight then\n        svg[#svg+1] = stringf([[\n            <text x=\"%d\" y=\"%d\" fill=\"%s\" font-size=\"24\" font-family=\"monospace\" text-anchor=\"middle\">AWAITING TELEMETRY DATA</text>\n            <text x=\"%d\" y=\"%d\" fill=\"%s\" font-size=\"16\" font-family=\"monospace\" text-anchor=\"middle\">Link this board's databank to the same databank as your ArchHUD seat</text>\n        ]], sw/2, sh/2 - 20, warnColor, sw/2, sh/2 + 20, dimColor)\n        svg[#svg+1] = \"</svg>\"\n        return table.concat(svg)\n    end\n\n    -- ═══════════════════════════════════════\n    -- LEFT COLUMN: Flight Data\n    -- ═══════════════════════════════════════\n    local lx, ly = 30, 70\n\n    -- Flight Panel\n    svg[#svg+1] = stringf([[<rect x=\"%d\" y=\"%d\" width=\"580\" height=\"320\" fill=\"%s\" stroke=\"%s\" rx=\"6\"/>]], lx - 10, ly, panelColor, borderColor)\n    svg[#svg+1] = stringf([[<text x=\"%d\" y=\"%d\" fill=\"%s\" font-size=\"16\" font-family=\"monospace\" font-weight=\"bold\">FLIGHT DATA</text>]], lx + 10, ly + 28, accentColor)\n\n    local fy = ly + 55\n    local lineH = 38\n\n    -- Speed\n    svg[#svg+1] = stringf([[<text x=\"%d\" y=\"%d\" fill=\"%s\" font-size=\"14\" font-family=\"monospace\">SPEED</text>]], lx + 10, fy, dimColor)\n    svg[#svg+1] = stringf([[<text x=\"%d\" y=\"%d\" fill=\"white\" font-size=\"28\" font-family=\"monospace\">%s</text>]], lx + 120, fy + 2, fmtSpeedKmh(flight.spd))\n    svg[#svg+1] = stringf([[<text x=\"%d\" y=\"%d\" fill=\"%s\" font-size=\"14\" font-family=\"monospace\">(%s)</text>]], lx + 380, fy, dimColor, fmtSpeed(flight.spd))\n    fy = fy + lineH + 6\n\n    -- Altitude\n    svg[#svg+1] = stringf([[<text x=\"%d\" y=\"%d\" fill=\"%s\" font-size=\"14\" font-family=\"monospace\">ALTITUDE</text>]], lx + 10, fy, dimColor)\n    svg[#svg+1] = stringf([[<text x=\"%d\" y=\"%d\" fill=\"white\" font-size=\"28\" font-family=\"monospace\">%s</text>]], lx + 120, fy + 2, fmtAlt(flight.alt))\n    fy = fy + lineH + 6\n\n    -- Vertical Speed\n    local vColor = \"white\"\n    if flight.vspd > 10 then vColor = safeColor\n    elseif flight.vspd < -10 then vColor = warnColor end\n    local vSign = flight.vspd >= 0 and \"+\" or \"\"\n    svg[#svg+1] = stringf([[<text x=\"%d\" y=\"%d\" fill=\"%s\" font-size=\"14\" font-family=\"monospace\">V-SPEED</text>]], lx + 10, fy, dimColor)\n    svg[#svg+1] = stringf([[<text x=\"%d\" y=\"%d\" fill=\"%s\" font-size=\"28\" font-family=\"monospace\">%s%.1f m/s</text>]], lx + 120, fy + 2, vColor, vSign, flight.vspd)\n    fy = fy + lineH + 6\n\n    -- Atmosphere / Throttle row\n    svg[#svg+1] = stringf([[<text x=\"%d\" y=\"%d\" fill=\"%s\" font-size=\"14\" font-family=\"monospace\">ATMO</text>]], lx + 10, fy, dimColor)\n    svg[#svg+1] = stringf([[<text x=\"%d\" y=\"%d\" fill=\"white\" font-size=\"22\" font-family=\"monospace\">%.1f%%</text>]], lx + 120, fy + 2, flight.atmo)\n    svg[#svg+1] = stringf([[<text x=\"%d\" y=\"%d\" fill=\"%s\" font-size=\"14\" font-family=\"monospace\">THROTTLE</text>]], lx + 280, fy, dimColor)\n    svg[#svg+1] = stringf([[<text x=\"%d\" y=\"%d\" fill=\"white\" font-size=\"22\" font-family=\"monospace\">%d%%</text>]], lx + 400, fy + 2, flight.thr)\n    fy = fy + lineH\n\n    -- Status indicators row\n    svg[#svg+1] = statusDot(lx + 10, fy + 8, flight.inA, \"IN ATMO\")\n    svg[#svg+1] = statusDot(lx + 140, fy + 8, flight.gear, \"GEAR\")\n    svg[#svg+1] = statusDot(lx + 240, fy + 8, flight.brk, \"BRAKE\")\n    svg[#svg+1] = statusDot(lx + 350, fy + 8, flight.near, \"NEAR PLANET\")\n\n    -- ═══════════════════════════════════════\n    -- RIGHT COLUMN: Autopilot\n    -- ═══════════════════════════════════════\n    local rx = 640\n\n    svg[#svg+1] = stringf([[<rect x=\"%d\" y=\"%d\" width=\"580\" height=\"320\" fill=\"%s\" stroke=\"%s\" rx=\"6\"/>]], rx - 10, ly, panelColor, borderColor)\n    svg[#svg+1] = stringf([[<text x=\"%d\" y=\"%d\" fill=\"%s\" font-size=\"16\" font-family=\"monospace\" font-weight=\"bold\">AUTOPILOT</text>]], rx + 10, ly + 28, accentColor)\n\n    if ap then\n        local ay = ly + 60\n\n        -- AP Status\n        local apStatusColor = ap.on and safeColor or dimColor\n        local apStatusText = ap.on and \"ENGAGED\" or \"OFF\"\n        svg[#svg+1] = stringf([[<text x=\"%d\" y=\"%d\" fill=\"%s\" font-size=\"14\" font-family=\"monospace\">STATUS</text>]], rx + 10, ay, dimColor)\n        svg[#svg+1] = stringf([[<text x=\"%d\" y=\"%d\" fill=\"%s\" font-size=\"24\" font-family=\"monospace\" font-weight=\"bold\">%s</text>]], rx + 120, ay + 2, apStatusColor, apStatusText)\n        ay = ay + lineH\n\n        -- AP Phase\n        svg[#svg+1] = stringf([[<text x=\"%d\" y=\"%d\" fill=\"%s\" font-size=\"14\" font-family=\"monospace\">PHASE</text>]], rx + 10, ay, dimColor)\n        svg[#svg+1] = stringf([[<text x=\"%d\" y=\"%d\" fill=\"white\" font-size=\"20\" font-family=\"monospace\">%s</text>]], rx + 120, ay + 2, ap.stat or \"---\")\n        ay = ay + lineH\n\n        -- Target\n        svg[#svg+1] = stringf([[<text x=\"%d\" y=\"%d\" fill=\"%s\" font-size=\"14\" font-family=\"monospace\">TARGET</text>]], rx + 10, ay, dimColor)\n        svg[#svg+1] = stringf([[<text x=\"%d\" y=\"%d\" fill=\"white\" font-size=\"20\" font-family=\"monospace\">%s</text>]], rx + 120, ay + 2, ap.tgt or \"None\")\n        ay = ay + lineH\n\n        -- Distance / Brake Distance\n        if ap.dist and ap.dist > 0 then\n            svg[#svg+1] = stringf([[<text x=\"%d\" y=\"%d\" fill=\"%s\" font-size=\"14\" font-family=\"monospace\">DISTANCE</text>]], rx + 10, ay, dimColor)\n            svg[#svg+1] = stringf([[<text x=\"%d\" y=\"%d\" fill=\"white\" font-size=\"20\" font-family=\"monospace\">%s</text>]], rx + 120, ay + 2, fmtDist(ap.dist))\n        end\n        ay = ay + lineH\n\n        if ap.bDist and ap.bDist > 0 then\n            svg[#svg+1] = stringf([[<text x=\"%d\" y=\"%d\" fill=\"%s\" font-size=\"14\" font-family=\"monospace\">BRAKE DIST</text>]], rx + 10, ay, dimColor)\n            svg[#svg+1] = stringf([[<text x=\"%d\" y=\"%d\" fill=\"%s\" font-size=\"20\" font-family=\"monospace\">%s</text>]], rx + 120, ay + 2, warnColor, fmtDist(ap.bDist))\n        end\n        ay = ay + lineH + 10\n\n        -- AP Mode indicators\n        svg[#svg+1] = statusDot(rx + 10, ay, ap.ah, \"ALT HOLD\")\n        svg[#svg+1] = statusDot(rx + 150, ay, ap.tb, \"TURN+BURN\")\n        svg[#svg+1] = statusDot(rx + 300, ay, ap.orb, \"ORBIT\")\n        svg[#svg+1] = statusDot(rx + 420, ay, ap.re, \"REENTRY\")\n    end\n\n    -- ═══════════════════════════════════════\n    -- BOTTOM LEFT: Fuel\n    -- ═══════════════════════════════════════\n    local by = 420\n\n    svg[#svg+1] = stringf([[<rect x=\"%d\" y=\"%d\" width=\"580\" height=\"220\" fill=\"%s\" stroke=\"%s\" rx=\"6\"/>]], lx - 10, by, panelColor, borderColor)\n    svg[#svg+1] = stringf([[<text x=\"%d\" y=\"%d\" fill=\"%s\" font-size=\"16\" font-family=\"monospace\" font-weight=\"bold\">FUEL</text>]], lx + 10, by + 28, accentColor)\n\n    if fuel then\n        local barY = by + 50\n        local barW = 420\n        local barH = 18\n        local barSpacing = 55\n\n        if fuel.atmo then\n            svg[#svg+1] = fuelBar(lx + 10, barY, barW, barH, fuel.atmo.pct, stringf(\"ATMO  [%d]\", fuel.atmo.count))\n            barY = barY + barSpacing\n        end\n        if fuel.space then\n            svg[#svg+1] = fuelBar(lx + 10, barY, barW, barH, fuel.space.pct, stringf(\"SPACE [%d]\", fuel.space.count))\n            barY = barY + barSpacing\n        end\n        if fuel.rocket then\n            svg[#svg+1] = fuelBar(lx + 10, barY, barW, barH, fuel.rocket.pct, stringf(\"RCKT  [%d]\", fuel.rocket.count))\n        end\n    else\n        svg[#svg+1] = stringf([[<text x=\"%d\" y=\"%d\" fill=\"%s\" font-size=\"14\" font-family=\"monospace\">No fuel data available</text>]], lx + 10, by + 60, dimColor)\n    end\n\n    -- ═══════════════════════════════════════\n    -- BOTTOM RIGHT: Ship Status & Odometer\n    -- ═══════════════════════════════════════\n    svg[#svg+1] = stringf([[<rect x=\"%d\" y=\"%d\" width=\"580\" height=\"220\" fill=\"%s\" stroke=\"%s\" rx=\"6\"/>]], rx - 10, by, panelColor, borderColor)\n    svg[#svg+1] = stringf([[<text x=\"%d\" y=\"%d\" fill=\"%s\" font-size=\"16\" font-family=\"monospace\" font-weight=\"bold\">SHIP STATUS</text>]], rx + 10, by + 28, accentColor)\n\n    local sy = by + 60\n\n    -- Shield\n    if ship and ship.shld >= 0 then\n        local shieldColor = accentColor\n        if ship.shld < 25 then shieldColor = dangerColor\n        elseif ship.shld < 50 then shieldColor = warnColor end\n        svg[#svg+1] = stringf([[<text x=\"%d\" y=\"%d\" fill=\"%s\" font-size=\"14\" font-family=\"monospace\">SHIELD</text>]], rx + 10, sy, dimColor)\n        svg[#svg+1] = stringf([[<text x=\"%d\" y=\"%d\" fill=\"%s\" font-size=\"24\" font-family=\"monospace\">%d%%</text>]], rx + 120, sy + 2, shieldColor, ship.shld)\n    else\n        svg[#svg+1] = stringf([[<text x=\"%d\" y=\"%d\" fill=\"%s\" font-size=\"14\" font-family=\"monospace\">SHIELD</text>]], rx + 10, sy, dimColor)\n        svg[#svg+1] = stringf([[<text x=\"%d\" y=\"%d\" fill=\"%s\" font-size=\"20\" font-family=\"monospace\">N/A</text>]], rx + 120, sy + 2, dimColor)\n    end\n\n    -- Mass\n    if flight then\n        svg[#svg+1] = stringf([[<text x=\"%d\" y=\"%d\" fill=\"%s\" font-size=\"14\" font-family=\"monospace\">MASS</text>]], rx + 280, sy, dimColor)\n        local massStr = flight.mass > 1000 and stringf(\"%.1f t\", flight.mass / 1000) or stringf(\"%d kg\", flight.mass)\n        svg[#svg+1] = stringf([[<text x=\"%d\" y=\"%d\" fill=\"white\" font-size=\"20\" font-family=\"monospace\">%s</text>]], rx + 380, sy + 2, massStr)\n    end\n    sy = sy + 50\n\n    -- Odometer\n    svg[#svg+1] = stringf([[<line x1=\"%d\" y1=\"%d\" x2=\"%d\" y2=\"%d\" stroke=\"%s\" stroke-width=\"1\"/>]], rx, sy - 15, rx + 560, sy - 15, borderColor)\n    svg[#svg+1] = stringf([[<text x=\"%d\" y=\"%d\" fill=\"%s\" font-size=\"15\" font-family=\"monospace\" font-weight=\"bold\">ODOMETER</text>]], rx + 10, sy, accentColor)\n    sy = sy + 32\n\n    if ship then\n        svg[#svg+1] = stringf([[<text x=\"%d\" y=\"%d\" fill=\"%s\" font-size=\"14\" font-family=\"monospace\">TOTAL DIST</text>]], rx + 10, sy, dimColor)\n        svg[#svg+1] = stringf([[<text x=\"%d\" y=\"%d\" fill=\"white\" font-size=\"20\" font-family=\"monospace\">%s</text>]], rx + 160, sy + 2, fmtDist(ship.odo))\n\n        svg[#svg+1] = stringf([[<text x=\"%d\" y=\"%d\" fill=\"%s\" font-size=\"14\" font-family=\"monospace\">FLIGHT TIME</text>]], rx + 300, sy, dimColor)\n        svg[#svg+1] = stringf([[<text x=\"%d\" y=\"%d\" fill=\"white\" font-size=\"20\" font-family=\"monospace\">%s</text>]], rx + 450, sy + 2, fmtTime(ship.ft))\n    end\n\n    -- ═══════════════════════════════════════\n    -- BOTTOM BAR: Data freshness\n    -- ═══════════════════════════════════════\n    if flight and flight.time then\n        local age = system.getArkTime() - flight.time\n        local freshColor = age < 3 and safeColor or (age < 10 and warnColor or dangerColor)\n        local freshText = age < 3 and \"LIVE\" or stringf(\"%.0fs AGO\", age)\n        svg[#svg+1] = stringf([[\n            <circle cx=\"30\" cy=\"%d\" r=\"5\" fill=\"%s\"/>\n            <text x=\"42\" y=\"%d\" fill=\"%s\" font-size=\"13\" font-family=\"monospace\">DATA: %s</text>\n        ]], sh - 20, freshColor, sh - 15, freshColor, freshText)\n    end\n\n    svg[#svg+1] = \"</svg>\"\n    return table.concat(svg)\nend\n\n-- ════════════════════════════════════════════\n-- Timer callback (global so unit > onTimer can call it)\n-- In unit > onTimer, paste:  onBoardTick(timerId)\n-- ════════════════════════════════════════════\nfunction onBoardTick(timerId)\n    if timerId == \"refresh\" then\n        if screen and db then\n            screen.setHTML(renderDashboard())\n        end\n    end\nend\n\n-- ════════════════════════════════════════════\n-- Auto-initialization (runs on unit > onStart)\n-- ════════════════════════════════════════════\nif not db then\n    system.print(\"ArchHUD Telemetry: No databank linked. Rename the databank slot to 'db' and restart.\")\n    return\nend\nif not screen then\n    system.print(\"ArchHUD Telemetry: No screen linked. Rename the screen slot to 'screen' and restart.\")\n    return\nend\nunit.setTimer(\"refresh\", 1)\nsystem.print(\"ArchHUD Telemetry Dashboard started.\")\nscreen.setHTML(renderDashboard())\n",
      "filter": {
        "args": [],
        "signature": "onStart()",
        "slotKey": "-1"
      },
      "key": "0"
    },
    {
      "code": "onBoardTick(timerId)",
      "filter": {
        "args": [
          {
            "value": "refresh"
          }
        ],
        "signature": "onTimer(timerId)",
        "slotKey": "-1"
      },
      "key": "1"
    },
    {
      "code": "if screen then screen.setHTML(\"\") end",
      "filter": {
        "args": [],
        "signature": "onStop()",
        "slotKey": "-1"
      },
      "key": "2"
    }
  ],
  "methods": [],
  "events": []
}