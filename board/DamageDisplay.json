{
  "slots": {
    "0": {
      "name": "db",
      "type": {
        "events": [],
        "methods": []
      }
    },
    "1": {
      "name": "screen",
      "type": {
        "events": [],
        "methods": []
      }
    },
    "-1": {
      "name": "unit",
      "type": {
        "events": [],
        "methods": []
      }
    },
    "-2": {
      "name": "system",
      "type": {
        "events": [],
        "methods": []
      }
    },
    "-3": {
      "name": "library",
      "type": {
        "events": [],
        "methods": []
      }
    }
  },
  "handlers": [
    {
      "code": "-- ArchHUD Damage Report Display - Programming Board Script\n-- Reads damage telemetry (T_damage) from a shared databank and renders a full-screen\n-- damage report on a linked screen using setHTML() with SVG.\n--\n-- \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n-- SETUP INSTRUCTIONS\n-- \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n-- 1. Place a programming board, a screen, and link BOTH to the same databank\n--    used by your ArchHUD seat (the dbHud slot).\n-- 2. Right-click the programming board > Advanced > Edit Lua.\n-- 3. In the slot list (left side), rename the databank slot to \"db\"\n--    and the screen slot to \"screen\".\n-- 4. Select the filter: unit > onStart\n--    Paste this ENTIRE script into the code editor.\n-- 5. Add a NEW filter: unit > onTimer(timerId)\n--    Paste this single line:     onBoardTick(timerId)\n-- 6. Add a NEW filter: unit > onStop\n--    Paste this single line:     if screen then screen.setHTML(\"\") end\n-- 7. Apply changes and activate the programming board.\n-- \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n--\n-- The main ArchHUD publishes T_damage every 10 seconds while the pilot is seated.\n-- This board refreshes every 5 seconds.\n--\n-- Slots (rename in the Lua editor slot list):\n--   db     = databank (same one linked to your seat/ECU as dbHud)\n--   screen = ScreenUnit\n--\n-- Databank keys used:\n--   T_damage = {pct, dmg, off, tot, list=[{n, t, hp, mhp, off?}...]}\n--   T_flight = {time, ...}  (used for data freshness indicator)\n\nlocal db = db         ---@type databank\nlocal screen = screen ---@type ScreenUnit\nlocal unit = unit     ---@type ProgrammingBoard\nlocal system = system\n\n-- Cached standard library references\nlocal jdecode = json.decode\nlocal jencode = json.encode\nlocal mfloor  = math.floor\nlocal mmin    = math.min\nlocal mmax    = math.max\nlocal mceil   = math.ceil\nlocal stringf = string.format\n\n-- Pagination state: auto-advances each render cycle\nlocal currentPage = 0\n\n-- Alert state: track previous integrity to detect drops\nlocal prevIntegrity = 100\nlocal prevDisabled = 0\n\n-- \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n-- Utility Functions\n-- \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\n--- Safe JSON decode from a databank key. Returns decoded table or nil.\nlocal function safeDecode(key)\n    if not db.hasKey(key) then return nil end\n    local ok, result = pcall(jdecode, db.getStringValue(key))\n    if ok then return result end\n    return nil\nend\n\n--- Escape special XML/SVG characters in a string\nlocal function esc(str)\n    return str:gsub(\"&\", \"&amp;\"):gsub(\"<\", \"&lt;\"):gsub(\">\", \"&gt;\"):gsub('\"', \"&quot;\")\nend\n\n--- Color helper: build rgb() string\nlocal function rgb(r, g, b)\n    return stringf(\"rgb(%d,%d,%d)\", r, g, b)\nend\n\n--- Color helper: build rgba() string\nlocal function rgba(r, g, b, a)\n    return stringf(\"rgba(%d,%d,%d,%.2f)\", r, g, b, a)\nend\n\n-- \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n-- Theme Colors\n-- \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nlocal accentColor = rgb(130, 224, 255)            -- Cyan accent\nlocal dimColor    = rgb(90, 155, 180)             -- Muted label text\nlocal warnColor   = rgb(255, 165, 0)              -- Orange warning\nlocal dangerColor = rgb(255, 60, 60)              -- Red danger/destroyed\nlocal safeColor   = rgb(60, 255, 120)             -- Green safe/operational\nlocal bgColor     = rgb(12, 16, 22)               -- Dark background\nlocal panelColor  = rgba(20, 30, 40, 0.85)        -- Panel fill\nlocal borderColor = rgba(130, 224, 255, 0.3)      -- Panel border\n\n-- \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n-- Color Computation\n-- \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\n--- Compute integrity percentage color with smooth gradient:\n---   100% = green rgb(60, 255, 120)\n---    50% = yellow rgb(255, 255, 0)\n---     0% = red rgb(255, 60, 60)\nlocal function integrityColor(pct)\n    pct = mmax(0, mmin(100, pct))\n    if pct >= 50 then\n        -- Interpolate: yellow(50%) -> green(100%)\n        local t = (pct - 50) / 50\n        local r = mfloor(255 - 195 * t)    -- 255 -> 60\n        local g = 255                       -- 255 -> 255\n        local b = mfloor(120 * t)           -- 0   -> 120\n        return rgb(r, g, b)\n    else\n        -- Interpolate: red(0%) -> yellow(50%)\n        local t = pct / 50\n        local r = 255                       -- 255 -> 255\n        local g = mfloor(60 + 195 * t)     -- 60  -> 255\n        local b = mfloor(60 - 60 * t)      -- 60  -> 0\n        return rgb(r, g, b)\n    end\nend\n\n--- Compute element row color based on HP percentage.\n--- Damaged elements use yellow (high HP) to orange (low HP).\nlocal function elementColor(pct)\n    if pct >= 50 then\n        return rgb(255, 200, 50)    -- Yellow for higher HP remaining\n    else\n        return rgb(255, 130, 30)    -- Orange for lower HP remaining\n    end\nend\n\n-- \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n-- Main Render Function\n-- \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\n--- Build and return the complete SVG damage report as an HTML string.\nfunction renderDashboard()\n    local damage = safeDecode(\"T_damage\")\n    local flight = safeDecode(\"T_flight\")\n\n    -- Screen dimensions (DU screen HTML/SVG viewport)\n    local sw, sh = 1920, 1080\n\n    local svg = {}\n\n    -- SVG root element\n    svg[#svg+1] = stringf([[<svg viewBox=\"0 0 %d %d\" xmlns=\"http://www.w3.org/2000/svg\">]], sw, sh)\n\n    -- Background\n    svg[#svg+1] = stringf([[<rect width=\"%d\" height=\"%d\" fill=\"%s\"/>]], sw, sh, bgColor)\n\n    -- \u2500\u2500 Title Bar \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    svg[#svg+1] = stringf(\n        [[<rect x=\"0\" y=\"0\" width=\"%d\" height=\"50\" fill=\"%s\"/>]] ..\n        [[<text x=\"20\" y=\"34\" fill=\"%s\" font-size=\"22\" font-family=\"monospace\" font-weight=\"bold\">ARCHHUD DAMAGE REPORT</text>]],\n        sw, rgba(20, 30, 40, 0.95), accentColor)\n\n    -- \u2500\u2500 Data Freshness Indicator (top right) \u2500\u2500\u2500\n    if flight and flight.time then\n        local age = system.getArkTime() - flight.time\n        -- Damage updates every 10s, so 15s threshold for \"live\"\n        local freshColor = age < 15 and safeColor or (age < 30 and warnColor or dangerColor)\n        local freshText = age < 15 and \"LIVE\" or stringf(\"%.0fs AGO\", age)\n        svg[#svg+1] = stringf(\n            [[<circle cx=\"%d\" cy=\"25\" r=\"5\" fill=\"%s\"/>]] ..\n            [[<text x=\"%d\" y=\"30\" fill=\"%s\" font-size=\"14\" font-family=\"monospace\" text-anchor=\"end\">DATA: %s</text>]],\n            sw - 200, freshColor, sw - 20, freshColor, freshText)\n    end\n\n    -- \u2500\u2500 No Data Fallback \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    if not damage then\n        svg[#svg+1] = stringf(\n            [[<text x=\"%d\" y=\"%d\" fill=\"%s\" font-size=\"28\" font-family=\"monospace\" text-anchor=\"middle\" font-weight=\"bold\">AWAITING DATA</text>]] ..\n            [[<text x=\"%d\" y=\"%d\" fill=\"%s\" font-size=\"16\" font-family=\"monospace\" text-anchor=\"middle\">Link this board databank to the same databank as your ArchHUD seat</text>]] ..\n            [[<text x=\"%d\" y=\"%d\" fill=\"%s\" font-size=\"14\" font-family=\"monospace\" text-anchor=\"middle\">Damage telemetry is published every 10 seconds while seated</text>]],\n            sw/2, sh/2 - 30, warnColor,\n            sw/2, sh/2 + 10, dimColor,\n            sw/2, sh/2 + 40, dimColor)\n        svg[#svg+1] = \"</svg>\"\n        return table.concat(svg)\n    end\n\n    -- \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    -- Integrity Section\n    -- \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\n    local pct = damage.pct or 0\n    local iColor = integrityColor(pct)\n\n    -- Large percentage display (centered)\n    svg[#svg+1] = stringf(\n        [[<text x=\"%d\" y=\"150\" fill=\"%s\" font-size=\"80\" font-family=\"monospace\" font-weight=\"bold\" text-anchor=\"middle\">%.1f%%</text>]] ..\n        [[<text x=\"%d\" y=\"178\" fill=\"%s\" font-size=\"16\" font-family=\"monospace\" text-anchor=\"middle\">SHIP INTEGRITY</text>]],\n        sw/2, iColor, pct,\n        sw/2, dimColor)\n\n    -- Wide integrity bar (nearly full screen width)\n    local barX = 40\n    local barY = 198\n    local barW = sw - 80\n    local barH = 24\n    local barFill = mmax(0, mfloor(barW * pct / 100))\n\n    -- Bar background track\n    svg[#svg+1] = stringf(\n        [[<rect x=\"%d\" y=\"%d\" width=\"%d\" height=\"%d\" fill=\"%s\" rx=\"4\"/>]],\n        barX, barY, barW, barH, rgba(40, 50, 60, 0.8))\n\n    -- Bar fill (colored by integrity)\n    if barFill > 0 then\n        svg[#svg+1] = stringf(\n            [[<rect x=\"%d\" y=\"%d\" width=\"%d\" height=\"%d\" fill=\"%s\" rx=\"4\"/>]],\n            barX, barY, barFill, barH, iColor)\n    end\n\n    -- Bar border outline\n    svg[#svg+1] = stringf(\n        [[<rect x=\"%d\" y=\"%d\" width=\"%d\" height=\"%d\" fill=\"none\" stroke=\"%s\" stroke-width=\"1\" rx=\"4\"/>]],\n        barX, barY, barW, barH, borderColor)\n\n    -- Summary line: \"X damaged | Y disabled | Z total elements\"\n    local dmgCount = damage.dmg or 0\n    local offCount = damage.off or 0\n    local totCount = damage.tot or 0\n    svg[#svg+1] = stringf(\n        [[<text x=\"%d\" y=\"252\" fill=\"%s\" font-size=\"16\" font-family=\"monospace\" text-anchor=\"middle\">]] ..\n        [[%d damaged  |  %d disabled  |  %d total elements</text>]],\n        sw/2, dimColor, dmgCount, offCount, totCount)\n\n    -- \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    -- Element List Panel\n    -- \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\n    local listTop = 275\n    local listBot = sh - 40\n    local listX   = 40\n    local listW   = sw - 80\n\n    -- Panel background with border\n    svg[#svg+1] = stringf(\n        [[<rect x=\"%d\" y=\"%d\" width=\"%d\" height=\"%d\" fill=\"%s\" stroke=\"%s\" rx=\"6\"/>]],\n        listX - 10, listTop - 10, listW + 20, listBot - listTop + 20, panelColor, borderColor)\n\n    local list = damage.list\n\n    if not list or #list == 0 then\n        -- \u2500\u2500 All Systems Operational \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n        svg[#svg+1] = stringf(\n            [[<text x=\"%d\" y=\"%d\" fill=\"%s\" font-size=\"30\" font-family=\"monospace\" text-anchor=\"middle\" font-weight=\"bold\">]] ..\n            [[ALL SYSTEMS OPERATIONAL</text>]],\n            sw/2, (listTop + listBot) / 2, safeColor)\n    else\n        -- \u2500\u2500 Column Headers \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n        local hdrY = listTop + 10\n        svg[#svg+1] = stringf(\n            [[<text x=\"%d\" y=\"%d\" fill=\"%s\" font-size=\"13\" font-family=\"monospace\">ELEMENT NAME</text>]] ..\n            [[<text x=\"%d\" y=\"%d\" fill=\"%s\" font-size=\"13\" font-family=\"monospace\">TYPE</text>]] ..\n            [[<text x=\"%d\" y=\"%d\" fill=\"%s\" font-size=\"13\" font-family=\"monospace\">HEALTH</text>]] ..\n            [[<text x=\"%d\" y=\"%d\" fill=\"%s\" font-size=\"13\" font-family=\"monospace\">HP</text>]],\n            listX, hdrY, dimColor,\n            listX + 520, hdrY, dimColor,\n            listX + 1050, hdrY, dimColor,\n            listX + 1560, hdrY, dimColor)\n\n        -- Header separator line\n        svg[#svg+1] = stringf(\n            [[<line x1=\"%d\" y1=\"%d\" x2=\"%d\" y2=\"%d\" stroke=\"%s\" stroke-width=\"1\"/>]],\n            listX, hdrY + 10, listX + listW, hdrY + 10, borderColor)\n\n        -- \u2500\u2500 Pagination Calculation \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n        local totalItems = #list\n        local rowH = 50                              -- Height per element row\n        local contentTop = hdrY + 20                 -- First row content area starts here\n        local availH = listBot - contentTop - 10\n        local itemsPerPage = mmax(1, mfloor(availH / rowH))  -- Approximately 14 items\n        local totalPages = mmax(1, mceil(totalItems / itemsPerPage))\n        local page = currentPage % totalPages\n        local startIdx = page * itemsPerPage + 1\n        local endIdx = mmin(startIdx + itemsPerPage - 1, totalItems)\n\n        -- \u2500\u2500 Render Element Rows \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n        local ey = contentTop + 20\n        for i = startIdx, endIdx do\n            local elem = list[i]\n            if elem then\n                local eName  = elem.n or \"Unknown\"\n                local eType  = elem.t or \"\"\n                local eHP    = elem.hp or 0\n                local eMaxHP = elem.mhp or 1\n                local eOff   = elem.off\n                local ePct   = eMaxHP > 0 and (eHP / eMaxHP * 100) or 0\n\n                -- Truncate long names to fit columns\n                if #eName > 34 then eName = eName:sub(1, 32) .. \"..\" end\n                if #eType > 28 then eType = eType:sub(1, 26) .. \"..\" end\n\n                -- Escape for SVG/XML safety\n                eName = esc(eName)\n                eType = esc(eType)\n\n                -- Determine if element is destroyed/disabled\n                local isDestroyed = eHP <= 0 or eOff\n                local rowColor = isDestroyed and dangerColor or elementColor(ePct)\n\n                -- Element name (colored by status)\n                svg[#svg+1] = stringf(\n                    [[<text x=\"%d\" y=\"%d\" fill=\"%s\" font-size=\"15\" font-family=\"monospace\">%s</text>]],\n                    listX, ey, rowColor, eName)\n\n                -- Element type (dimmed)\n                svg[#svg+1] = stringf(\n                    [[<text x=\"%d\" y=\"%d\" fill=\"%s\" font-size=\"13\" font-family=\"monospace\">%s</text>]],\n                    listX + 520, ey, dimColor, eType)\n\n                -- HP bar background track\n                local hpBarX = listX + 1050\n                local hpBarW = 460\n                local hpBarH = 14\n                svg[#svg+1] = stringf(\n                    [[<rect x=\"%d\" y=\"%d\" width=\"%d\" height=\"%d\" fill=\"%s\" rx=\"2\"/>]],\n                    hpBarX, ey - 11, hpBarW, hpBarH, rgba(40, 50, 60, 0.8))\n\n                -- HP bar fill (colored by status)\n                local hpFill = mmax(0, mfloor(hpBarW * ePct / 100))\n                if hpFill > 0 then\n                    svg[#svg+1] = stringf(\n                        [[<rect x=\"%d\" y=\"%d\" width=\"%d\" height=\"%d\" fill=\"%s\" rx=\"2\"/>]],\n                        hpBarX, ey - 11, hpFill, hpBarH, rowColor)\n                end\n\n                -- HP text or DESTROYED label\n                if isDestroyed then\n                    svg[#svg+1] = stringf(\n                        [[<text x=\"%d\" y=\"%d\" fill=\"%s\" font-size=\"13\" font-family=\"monospace\" font-weight=\"bold\">DESTROYED</text>]],\n                        listX + 1560, ey, dangerColor)\n                else\n                    svg[#svg+1] = stringf(\n                        [[<text x=\"%d\" y=\"%d\" fill=\"%s\" font-size=\"13\" font-family=\"monospace\">%d / %d</text>]],\n                        listX + 1560, ey, dimColor, eHP, eMaxHP)\n                end\n\n                ey = ey + rowH\n            end\n        end\n\n        -- Page indicator (shown only when there are multiple pages)\n        if totalPages > 1 then\n            svg[#svg+1] = stringf(\n                [[<text x=\"%d\" y=\"%d\" fill=\"%s\" font-size=\"14\" font-family=\"monospace\" text-anchor=\"end\">PAGE %d / %d</text>]],\n                listX + listW, listBot + 5, dimColor, page + 1, totalPages)\n        end\n\n        -- Auto-advance page for next render cycle (cycles every 5 seconds)\n        currentPage = currentPage + 1\n    end\n\n    -- \u2500\u2500 Footer \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    svg[#svg+1] = stringf(\n        [[<text x=\"%d\" y=\"%d\" fill=\"%s\" font-size=\"12\" font-family=\"monospace\" text-anchor=\"end\">Refreshes every 5s  |  Damage data updates every 10s</text>]],\n        sw - 20, sh - 10, rgba(90, 155, 180, 0.5))\n\n    svg[#svg+1] = \"</svg>\"\n    return table.concat(svg)\nend\n\n--- Check damage data and write alert to databank if thresholds crossed\nlocal function checkAlerts()\n    local damage = safeDecode(\"T_damage\")\n    if not damage then return end\n\n    local pct = damage.pct or 100\n    local off = damage.off or 0\n    local alertMsg = nil\n\n    -- Alert on integrity threshold crossings (75%, 50%, 25%)\n    if pct < 25 and prevIntegrity >= 25 then\n        alertMsg = stringf(\"CRITICAL: Hull integrity %.0f%% - %d disabled\", pct, off)\n    elseif pct < 50 and prevIntegrity >= 50 then\n        alertMsg = stringf(\"WARNING: Hull integrity %.0f%% - %d elements damaged\", pct, damage.dmg or 0)\n    elseif pct < 75 and prevIntegrity >= 75 then\n        alertMsg = stringf(\"Hull integrity %.0f%% - taking damage\", pct)\n    end\n\n    -- Alert on new element destruction\n    if off > prevDisabled then\n        local newOff = off - prevDisabled\n        alertMsg = stringf(\"ALERT: %d element(s) destroyed! %d total disabled\", newOff, off)\n    end\n\n    prevIntegrity = pct\n    prevDisabled = off\n\n    if alertMsg then\n        db.setStringValue(\"A_damage\", jencode({\n            msg = alertMsg,\n            t = system.getArkTime()\n        }))\n    end\nend\n\n-- \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n-- Timer callback (global so unit > onTimer can call it)\n-- In unit > onTimer, paste:  onBoardTick(timerId)\n-- \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\nfunction onBoardTick(timerId)\n    if timerId == \"refresh\" then\n        if screen and db then\n            checkAlerts()\n            screen.setHTML(renderDashboard())\n        end\n    end\nend\n\n-- \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n-- Auto-initialization (runs on unit > onStart)\n-- \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\nif not db then\n    system.print(\"ArchHUD Damage: No databank linked. Rename the databank slot to 'db' and restart.\")\n    return\nend\nif not screen then\n    system.print(\"ArchHUD Damage: No screen linked. Rename the screen slot to 'screen' and restart.\")\n    return\nend\nunit.setTimer(\"refresh\", 5)\nsystem.print(\"ArchHUD Damage Report started.\")\nscreen.setHTML(renderDashboard())\n",
      "filter": {
        "args": [],
        "signature": "onStart()",
        "slotKey": "-1"
      },
      "key": "0"
    },
    {
      "code": "onBoardTick(timerId)",
      "filter": {
        "args": [
          {
            "value": "refresh"
          }
        ],
        "signature": "onTimer(timerId)",
        "slotKey": "-1"
      },
      "key": "1"
    },
    {
      "code": "if screen then screen.setHTML(\"\") end",
      "filter": {
        "args": [],
        "signature": "onStop()",
        "slotKey": "-1"
      },
      "key": "2"
    }
  ],
  "methods": [],
  "events": []
}